<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Evaluación de Proveedores</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/admin.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js?v=43"></script>
    <script src="js/supabase-service.js?v=44"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/admin-pdf.js?v=50"></script>
    <script>
        // Verificar autenticación antes de cargar la página
        (function () {
            const isAuthenticated = sessionStorage.getItem('adminAuthenticated') === 'true';

            if (!isAuthenticated) {
                window.location.href = 'login-admin.html';
                return;
            }

            // Limpiar sesión cuando el usuario sale de la página (navegación, retroceso, cierre de pestaña)
            // sessionStorage se limpia automáticamente al cerrar la pestaña, pero también lo hacemos explícitamente
            window.addEventListener('beforeunload', function () {
                sessionStorage.removeItem('adminAuthenticated');
                sessionStorage.removeItem('adminAuthTime');
            });
        })();
    </script>
</head>

<body>
    <div class="admin-layout">
        <nav class="admin-sidebar">
            <div class="sidebar-header">
                <h2>Panel Admin</h2>
            </div>
            <ul class="sidebar-menu">
                <li class="menu-item active" data-target="section-general"><svg class="nav-icon" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg> General</li>
                <li class="menu-item" data-target="section-items-producto"><svg class="nav-icon" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path
                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                        </path>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg> Ítems Producto</li>
                <li class="menu-item" data-target="section-items-servicio"><svg class="nav-icon" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                    </svg> Ítems Servicio</li>
                <li class="menu-item" data-target="section-evaluadores"><svg class="nav-icon" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg> Evaluadores</li>
                <li class="menu-item" data-target="section-proveedores"><svg class="nav-icon" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
                        <line x1="9" y1="22" x2="9" y2="22.01"></line>
                        <line x1="15" y1="22" x2="15" y2="22.01"></line>
                        <line x1="9" y1="18" x2="9" y2="18.01"></line>
                        <line x1="15" y1="18" x2="15" y2="18.01"></line>
                        <line x1="9" y1="14" x2="9" y2="14.01"></line>
                        <line x1="15" y1="14" x2="15" y2="14.01"></line>
                        <line x1="9" y1="10" x2="9" y2="10.01"></line>
                        <line x1="15" y1="10" x2="15" y2="10.01"></line>
                        <line x1="9" y1="6" x2="9" y2="6.01"></line>
                        <line x1="15" y1="6" x2="15" y2="6.01"></line>
                    </svg> Proveedores</li>
                <li class="menu-item" data-target="section-asignaciones"><svg class="nav-icon" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg> Asignaciones</li>
                <li class="menu-item" data-target="section-evaluaciones"><svg class="nav-icon" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg> Evaluaciones Guardadas</li>
                <li class="menu-item" data-target="section-pdfs"><svg class="nav-icon" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="12" y1="18" x2="12" y2="12"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg> Generar PDFs</li>
                <li class="menu-item menu-item-config-mobile" data-target="section-configuracion"><svg class="nav-icon"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg> Configuración</li>
            </ul>
            <div class="sidebar-footer">
                <button id="guardarConfigBtnSidebar" class="btn-save-sidebar">
                    <svg class="nav-icon" style="margin-right:8px" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    Guardar Todo
                </button>
                <button id="volverBtn" class="btn-secondary-sidebar">
                    <svg class="nav-icon" style="margin-right:8px" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                    Volver al Form
                </button>
                <button id="cerrarSesionBtn" class="btn-danger-sidebar">
                    <svg class="nav-icon" style="margin-right:8px" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Cerrar Sesión
                </button>
            </div>
        </nav>

        <main class="admin-main-content">
            <header class="main-header">
                <h1 id="headerTitle">Información General</h1>
                <p>Gestiona la configuración del sistema de evaluación</p>
            </header>

            <!-- Menú desplegable móvil -->
            <div id="menuConfigMobileDropdown" class="menu-config-mobile-dropdown" style="display: none;">
                <button id="guardarTodoMobile" class="menu-config-item">💾 Guardar Todo</button>
                <button id="cambiarPasswordMobile" class="menu-config-item">🔐 Cambiar Contraseña</button>
                <button id="cerrarSesionMobile" class="menu-config-item">🚪 Cerrar Sesión</button>
            </div>

            <div class="content-wrapper">
                <!-- Sección: Información General -->
                <section id="section-general" class="admin-section active-section">
                    <h2>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        Información General
                    </h2>
                    <div class="form-group">
                        <label>Título Principal:</label>
                        <input type="text" id="tituloPrincipal" placeholder="Evaluación de Proveedores">
                    </div>
                    <div class="form-group">
                        <label>Descripción de la Evaluación:</label>
                        <textarea id="descripcionEvaluacion" rows="3"
                            placeholder="Este sistema permite evaluar..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Objetivo:</label>
                        <textarea id="objetivoEvaluacion" rows="3"
                            placeholder="Medir y mejorar continuamente..."></textarea>
                    </div>

                    <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e0e0e0;">
                        <h3 style="margin-bottom: 20px; color: #333;">📅 Configuración de Fechas de la Encuesta</h3>

                        <div class="form-group">
                            <label>Año de la Encuesta:</label>
                            <input type="number" id="anioEncuesta" min="2020" max="2100" placeholder="2025"
                                style="width: 200px;">
                            <small style="display: block; color: #666; margin-top: 5px;">
                                Define el año al que corresponde esta encuesta (no se pueden seleccionar años anteriores
                                al actual)
                            </small>
                        </div>

                        <div class="form-group">
                            <label>Fecha de Inicio (Desde):</label>
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <input type="date" id="fechaInicioEncuesta" style="width: 200px;">
                                <input type="time" id="horaInicioEncuesta" style="width: 150px;">
                            </div>
                            <small style="display: block; color: #666; margin-top: 5px;">
                                Fecha y hora desde la cual la encuesta estará disponible para los evaluadores
                            </small>
                        </div>

                        <div class="form-group">
                            <label>Fecha de Fin (Hasta):</label>
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <input type="date" id="fechaFinEncuesta" style="width: 200px;">
                                <input type="time" id="horaFinEncuesta" style="width: 150px;">
                            </div>
                            <small style="display: block; color: #666; margin-top: 5px;">
                                Fecha y hora hasta la cual la encuesta estará disponible para los evaluadores
                            </small>
                        </div>

                        <div class="form-group">
                            <label>Zona Horaria:</label>
                            <select id="zonaHorariaEncuesta" style="width: 200px;">
                                <option value="America/Santiago">Chile (Santiago) - UTC-3</option>
                                <option value="America/Mexico_City">México (Ciudad de México) - UTC-6</option>
                                <option value="America/Bogota">Colombia (Bogotá) - UTC-5</option>
                                <option value="America/Lima">Perú (Lima) - UTC-5</option>
                                <option value="America/Buenos_Aires">Argentina (Buenos Aires) - UTC-3</option>
                                <option value="America/Caracas">Venezuela (Caracas) - UTC-4</option>
                                <option value="UTC">UTC (Coordinated Universal Time)</option>
                            </select>
                            <small style="display: block; color: #666; margin-top: 5px;">
                                Seleccione la zona horaria para las fechas de inicio y fin
                            </small>
                        </div>

                        <div id="mensajeFechas"
                            style="display: none; padding: 10px; margin-top: 15px; border-radius: 5px;"></div>
                    </div>
                </section>

                <!-- Sección: Ítems de PRODUCTO -->
                <section id="section-items-producto" class="admin-section" style="display: none;">
                    <h2>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                            </path>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                        </svg>
                        Ítems de Evaluación - PRODUCTO
                    </h2>
                    <div id="itemsProductoContainer"></div>
                    <button type="button" id="agregarItemProducto" class="btn-add">+ Agregar Ítem</button>
                </section>

                <!-- Sección: Ítems de SERVICIO -->
                <section id="section-items-servicio" class="admin-section" style="display: none;">
                    <h2>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                        </svg>
                        Ítems de Evaluación - SERVICIO
                    </h2>
                    <div id="itemsServicioContainer"></div>
                    <button type="button" id="agregarItemServicio" class="btn-add">+ Agregar Ítem</button>
                </section>

                <!-- Sección: Gestión de Evaluadores -->
                <section id="section-evaluadores" class="admin-section" style="display: none;">
                    <h2>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Gestión de Evaluadores
                    </h2>
                    <div class="form-group">
                        <label>Agregar Nuevo Evaluador:</label>
                        <div class="add-evaluador-container">
                            <input type="text" id="nuevoEvaluador" placeholder="Nombre del evaluador">
                            <button type="button" id="agregarEvaluadorBtn" class="btn-add">+ Agregar Evaluador</button>
                        </div>
                    </div>
                    <div id="evaluadoresList" class="evaluadores-grid"></div>
                </section>

                <!-- Sección: Gestión de Proveedores -->
                <section id="section-proveedores" class="admin-section" style="display: none;">
                    <h2>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
                            <line x1="9" y1="22" x2="9" y2="22.01"></line>
                            <line x1="15" y1="22" x2="15" y2="22.01"></line>
                            <line x1="9" y1="18" x2="9" y2="18.01"></line>
                            <line x1="15" y1="18" x2="15" y2="18.01"></line>
                            <line x1="9" y1="14" x2="9" y2="14.01"></line>
                            <line x1="15" y1="14" x2="15" y2="14.01"></line>
                            <line x1="9" y1="10" x2="9" y2="10.01"></line>
                            <line x1="15" y1="10" x2="15" y2="10.01"></line>
                            <line x1="9" y1="6" x2="9" y2="6.01"></line>
                            <line x1="15" y1="6" x2="15" y2="6.01"></line>
                        </svg>
                        Gestión de Proveedores
                    </h2>
                    <div class="form-group">
                        <label>Agregar Nuevo Proveedor:</label>
                        <div class="add-proveedor-container">
                            <input type="text" id="nuevoProveedor" placeholder="Nombre del proveedor">
                            <input type="email" id="emailNuevoProveedor" placeholder="Email del proveedor"
                                style="margin-right: 10px;">
                            <select id="tipoNuevoProveedor">
                                <option value="PRODUCTO">PRODUCTO</option>
                                <option value="SERVICIO">SERVICIO</option>
                            </select>
                            <button type="button" id="agregarProveedorBtn" class="btn-add">+ Agregar Proveedor</button>
                        </div>
                    </div>
                    <div id="proveedoresList" class="proveedores-grid"></div>
                </section>

                <!-- Sección: Asignación de Proveedores a Evaluadores -->
                <section id="section-asignaciones" class="admin-section" style="display: none;">
                    <h2>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                        Asignar Proveedores a Evaluadores
                    </h2>
                    <p class="section-description">Selecciona un evaluador y asigna sus proveedores correspondientes:
                    </p>
                    <div id="asignacionesContainer" class="asignaciones-container"></div>
                </section>

                <!-- Sección: Evaluaciones Guardadas -->
                <section id="section-evaluaciones" class="admin-section" style="display: none;">
                    <h2>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        Evaluaciones Guardadas
                    </h2>
                    <div style="margin-bottom: 20px;">
                        <div class="form-group">
                            <label
                                style="display: block; margin-bottom: 10px; font-weight: 600; color: #333; font-size: 1.1rem;">📅
                                Seleccione el Año:</label>
                            <select id="filtroAnio"
                                style="width: 100%; max-width: 300px; padding: 12px; border: 2px solid #667eea; border-radius: 8px; font-size: 1rem; font-weight: 600;">
                                <option value="">-- Seleccione un año --</option>
                            </select>
                        </div>
                        <div id="contenidoAnio" style="display: none; margin-top: 20px;">
                            <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <button type="button" id="descargarAnioCompletoBtn" class="btn-add"
                                    style="width: 100%; padding: 12px 20px; font-size: 1rem; white-space: normal; word-wrap: break-word;">📥
                                    DESCARGAR TODO EL AÑO SELECCIONADO</button>
                            </div>
                            <h3 style="margin-bottom: 15px; color: #333;">Evaluaciones Individuales:</h3>
                            <div id="evaluacionesList"></div>
                        </div>
                    </div>
                </section>

                <!-- Sección: Generar PDFs -->
                <section id="section-pdfs" class="admin-section" style="display: none;">
                    <h2>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="12" y1="18" x2="12" y2="12"></line>
                            <line x1="9" y1="15" x2="15" y2="15"></line>
                        </svg>
                        Generar PDFs de Evaluaciones
                    </h2>
                    <div style="margin-bottom: 20px;">
                        <div class="form-group">
                            <label
                                style="display: block; margin-bottom: 10px; font-weight: 600; color: #333; font-size: 1.1rem;">📅
                                Seleccione el Año:</label>
                            <select id="filtroAnioPDF"
                                style="width: 100%; max-width: 300px; padding: 12px; border: 2px solid #667eea; border-radius: 8px; font-size: 1rem; font-weight: 600;">
                                <option value="">-- Seleccione un año --</option>
                            </select>
                        </div>
                        <div id="contenidoAnioPDF" style="display: none; margin-top: 20px;">
                            <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <button type="button" id="descargarPDFAnioCompletoBtn" class="btn-add"
                                    style="width: 100%; padding: 12px 20px; font-size: 1rem; white-space: normal; word-wrap: break-word;">📥
                                    DESCARGAR TODOS LOS PDFs DEL AÑO SELECCIONADO</button>
                            </div>
                            <h3 style="margin-bottom: 15px; color: #333;">PDFs Individuales:</h3>
                            <div id="pdfsList"></div>
                        </div>
                    </div>
                </section>

                <!-- Sección: Configuración (Cambiar contraseña, etc) -->
                <section id="section-configuracion" class="admin-section" style="display: none;">
                    <h2>
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                            </path>
                        </svg>
                        Configuración del Sistema
                    </h2>

                    <!-- Sección: Cambiar Contraseña -->
                    <div class="config-card"
                        style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: 2px solid rgba(102, 126, 234, 0.3); padding: 20px; border-radius: 10px;">
                        <h3>🔐 Cambiar Contraseña de Administrador</h3>
                        <p class="section-description" style="color: #666; margin-bottom: 20px;">Actualiza la contraseña
                            de acceso al panel de administración</p>
                        <div class="form-group">
                            <label>Contraseña Actual:</label>
                            <input type="password" id="passwordActual" placeholder="Ingrese su contraseña actual">
                        </div>
                        <div class="form-group">
                            <label>Nueva Contraseña:</label>
                            <input type="password" id="nuevaPassword" placeholder="Ingrese la nueva contraseña">
                        </div>
                        <div class="form-group">
                            <label>Confirmar Nueva Contraseña:</label>
                            <input type="password" id="confirmarPassword" placeholder="Confirme la nueva contraseña">
                        </div>
                        <button type="button" id="cambiarPasswordBtn" class="btn-add"
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">�
                            Cambiar Contraseña</button>
                        <div id="mensajePassword" class="mensaje-exito" style="display: none; margin-top: 15px;"></div>
                    </div>
                </section>

                <!-- Sección para mensajes globales -->
                <div id="mensajeGuardado" class="mensaje-exito" style="display: none; margin-top: 20px;"></div>


            </div>
        </main>
    </div>

    <script src="js/admin.js?v=53"></script>
    <script>
        // Script para manejar el menú móvil de configuración
        document.addEventListener('DOMContentLoaded', function () {
            const menuConfigDropdown = document.getElementById('menuConfigMobileDropdown');
            const guardarTodoMobile = document.getElementById('guardarTodoMobile');
            const cambiarPasswordMobile = document.getElementById('cambiarPasswordMobile');
            const cerrarSesionMobile = document.getElementById('cerrarSesionMobile');

            // Cerrar menú al hacer clic fuera
            if (menuConfigDropdown) {
                document.addEventListener('click', function (e) {
                    if (!menuConfigDropdown.contains(e.target)) {
                        const configMenuItem = document.querySelector('.menu-item-config-mobile');
                        if (configMenuItem && !configMenuItem.contains(e.target)) {
                            menuConfigDropdown.style.display = 'none';
                        }
                    }
                });
            }

            // Guardar Todo
            if (guardarTodoMobile) {
                guardarTodoMobile.addEventListener('click', async function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    menuConfigDropdown.style.display = 'none';
                    console.log('💾 Botón guardar móvil clickeado');

                    try {
                        if (typeof guardarConfiguracionCompleta === 'function') {
                            await guardarConfiguracionCompleta();
                        } else {
                            console.error('La función guardarConfiguracionCompleta no está definida');
                            alert('Error: No se pudo guardar la configuración. Por favor, recargue la página.');
                        }
                    } catch (error) {
                        console.error('Error al guardar desde móvil:', error);
                        alert('Error al guardar: ' + (error.message || 'Error desconocido'));
                    }
                });
            }

            // Cambiar Contraseña - ir a sección de configuración
            if (cambiarPasswordMobile) {
                cambiarPasswordMobile.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    menuConfigDropdown.style.display = 'none';

                    // Activar sección de configuración
                    setTimeout(function () {
                        const menuItems = document.querySelectorAll('.menu-item');
                        const sections = document.querySelectorAll('.admin-section');
                        const headerTitle = document.getElementById('headerTitle');

                        // Ocultar todas las secciones
                        sections.forEach(section => {
                            section.style.display = 'none';
                            section.classList.remove('active-section');
                        });

                        // Mostrar sección de configuración
                        const configSection = document.getElementById('section-configuracion');
                        if (configSection) {
                            configSection.style.display = 'block';
                            configSection.classList.add('active-section');
                        }

                        // Actualizar menú activo
                        menuItems.forEach(item => {
                            item.classList.remove('active');
                            if (item.getAttribute('data-target') === 'section-configuracion') {
                                item.classList.add('active');
                            }
                        });

                        // Actualizar título
                        if (headerTitle) {
                            headerTitle.textContent = '⚙️ Configuración';
                        }

                        // Scroll al inicio
                        window.scrollTo(0, 0);
                    }, 200);
                });
            }

            // Cerrar Sesión
            if (cerrarSesionMobile) {
                cerrarSesionMobile.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    menuConfigDropdown.style.display = 'none';

                    // Cerrar sesión directamente (sin confirmación adicional, el botón del sidebar ya tiene una)
                    sessionStorage.removeItem('adminAuthenticated');
                    sessionStorage.removeItem('adminAuthTime');
                    window.location.href = 'login-admin.html';
                });
            }
        });

        // Script para manejar la navegación del sidebar
        document.addEventListener('DOMContentLoaded', function () {
            const menuItems = document.querySelectorAll('.menu-item');
            const sections = document.querySelectorAll('.admin-section');
            const headerTitle = document.getElementById('headerTitle');

            // Función para cambiar de sección
            function switchSection(targetId, titleText) {
                // Ocultar todas las secciones
                sections.forEach(section => {
                    section.style.display = 'none';
                    section.classList.remove('active-section');
                });

                // Mostrar la sección objetivo
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.style.display = 'block';
                    targetSection.classList.add('active-section');
                    // Scroll al inicio del contenido
                    window.scrollTo(0, 0);
                }

                // Actualizar menú activo
                menuItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-target') === targetId) {
                        item.classList.add('active');
                    }
                });

                // Actualizar título
                if (headerTitle) {
                    headerTitle.textContent = titleText;
                }
            }

            // Event listeners para el menú
            menuItems.forEach(item => {
                item.addEventListener('click', function (e) {
                    const target = this.getAttribute('data-target');

                    // En móviles, si es el item de configuración, abrir el menú desplegable
                    if (target === 'section-configuracion' && window.innerWidth <= 900) {
                        e.preventDefault();
                        e.stopPropagation();
                        const menuConfigDropdown = document.getElementById('menuConfigMobileDropdown');
                        if (menuConfigDropdown) {
                            const isVisible = menuConfigDropdown.style.display === 'block';
                            menuConfigDropdown.style.display = isVisible ? 'none' : 'block';
                            return false; // No cambiar de sección
                        }
                    }

                    // Obtener texto del título (sin el icono si se prefiere)
                    let title = this.textContent;
                    switchSection(target, title);
                });
            });

            // Vincular el botón de guardar del sidebar al botón original (que puede estar oculto o lo usamos directamente)
            const guardarBtnSidebar = document.getElementById('guardarConfigBtnSidebar');
            if (guardarBtnSidebar) {
                guardarBtnSidebar.addEventListener('click', async function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('💾 Botón guardar sidebar clickeado');
                    try {
                        if (typeof guardarConfiguracionCompleta === 'function') {
                            await guardarConfiguracionCompleta();
                        } else {
                            console.error('La función guardarConfiguracionCompleta no está definida');
                            alert('Error: No se pudo guardar la configuración. Por favor, recargue la página.');
                        }
                    } catch (error) {
                        console.error('Error al guardar desde sidebar:', error);
                        alert('Error al guardar: ' + (error.message || 'Error desconocido'));
                    }
                });
            }
        });
    </script>
</body>

</html>