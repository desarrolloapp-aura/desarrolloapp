<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluaci√≥n de Proveedores</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/supabase-service.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
    <div class="container">
        <!-- Mensaje de rango de fechas -->
        <div id="mensajeRangoFechas" class="mensaje-rango-fechas" style="display: none;">
            <div class="mensaje-rango-contenido">
                <span class="mensaje-icono">‚ÑπÔ∏è</span>
                <div class="mensaje-texto">
                    <strong id="mensajeRangoTitulo">Informaci√≥n de disponibilidad</strong>
                    <p id="mensajeRangoTexto"></p>
                </div>
            </div>
        </div>

        <header>
            <h1 id="tituloPrincipal">Evaluaci√≥n de Proveedores</h1>
        </header>

        <!-- Indicador de Progreso -->
        <div class="progress-indicator" id="progressIndicator" style="display: none;">
            <div class="progress-step active" data-step="0">
                <div class="progress-step-number">1</div>
                <div class="progress-step-label">Informaci√≥n</div>
            </div>
            <div class="progress-step" data-step="1">
                <div class="progress-step-number">2</div>
                <div class="progress-step-label">Datos Iniciales</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="progress-step-number">3</div>
                <div class="progress-step-label">Proveedor</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="progress-step-number">4</div>
                <div class="progress-step-label">Evaluaci√≥n</div>
            </div>
            <div class="progress-step" data-step="4">
                <div class="progress-step-number">5</div>
                <div class="progress-step-label">Resultado</div>
            </div>
        </div>

        <!-- Paso 0: Informaci√≥n -->
        <div class="form-step active" id="step0" data-step="0">
            <section class="info-section">
                <div class="info-content">
                    <h2>üìã ¬øQu√© es esta evaluaci√≥n?</h2>
                    <p id="descripcionEvaluacion">Este sistema permite evaluar el desempe√±o de nuestros proveedores
                        mediante un proceso estructurado y objetivo, considerando diferentes aspectos seg√∫n el tipo de
                        proveedor (Producto o Servicio).</p>

                    <h3>üéØ Objetivo</h3>
                    <p id="objetivoEvaluacion">Medir y mejorar continuamente la calidad de nuestros proveedores,
                        asegurando que cumplan con los est√°ndares requeridos en t√©rminos de:</p>
                    <ul>
                        <li>Calidad de productos/servicios</li>
                        <li>Cumplimiento de plazos</li>
                        <li>Comunicaci√≥n y respuesta</li>
                        <li>Certificaciones y cumplimiento normativo</li>
                    </ul>

                    <h3>üìä ¬øC√≥mo funciona la evaluaci√≥n?</h3>
                    <div class="process-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>Selecci√≥n del Evaluador</strong>
                                <p>Cada evaluador tiene asignados proveedores espec√≠ficos seg√∫n su √°rea de
                                    responsabilidad.</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>Tipo de Proveedor</strong>
                                <p>Selecciona si el proveedor es de <strong>PRODUCTO</strong> o
                                    <strong>SERVICIO</strong> ya que cada tipo tiene criterios de evaluaci√≥n diferentes.
                                </p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <strong>Evaluaci√≥n por √çtems</strong>
                                <p>Cada √≠tem se califica con: <strong>25%</strong> <strong>50%</strong>
                                    <strong>75%</strong> o <strong>100%</strong> seg√∫n el cumplimiento observado.
                                </p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <strong>C√°lculo Autom√°tico</strong>
                                <p>El sistema calcula autom√°ticamente el resultado final ponderado, considerando la
                                    importancia de cada √≠tem.</p>
                            </div>
                        </div>
                    </div>

                    <h3>üìà Criterios de Evaluaci√≥n</h3>

                    <div class="criteria-box" id="criteriaProducto">
                        <h4>üü¶ Proveedores de PRODUCTO</h4>
                        <p id="textoProducto">Se eval√∫an <span id="cantidadProducto">7</span> aspectos con las
                            siguientes ponderaciones:</p>
                        <ul id="listaProducto">
                            <!-- Se llena din√°micamente desde la configuraci√≥n -->
                        </ul>
                    </div>

                    <div class="criteria-box" id="criteriaServicio">
                        <h4>üü© Proveedores de SERVICIO</h4>
                        <p id="textoServicio">Se eval√∫an <span id="cantidadServicio">6</span> aspectos con las
                            siguientes ponderaciones:</p>
                        <ul id="listaServicio">
                            <!-- Se llena din√°micamente desde la configuraci√≥n -->
                        </ul>
                    </div>

                    <div class="info-note">
                        <strong>‚ö†Ô∏è Importante:</strong> Cada evaluador solo puede evaluar a los proveedores que tiene
                        asignados. Una vez evaluado un proveedor, no aparecer√° nuevamente en la lista hasta que se
                        elimine la evaluaci√≥n anterior.
                    </div>
                </div>
            </section>
            <div class="step-navigation">
                <button type="button" id="comenzarBtn" class="btn-next" onclick="siguientePaso()">Comenzar ‚Üí</button>
            </div>
        </div>

        <form id="evaluationForm">
            <!-- Paso 1: Evaluador, Fecha y Tipo -->
            <div class="form-step" id="step1" data-step="1">
                <section class="form-section">
                    <h2>1. Seleccione el Evaluador</h2>
                    <select id="evaluador" required>
                        <option value="">-- Seleccione un evaluador --</option>
                    </select>
                </section>

                <section class="form-section">
                    <h2>2. Fecha de Evaluaci√≥n</h2>
                    <div class="fecha-display" id="fechaDisplay">
                        <span id="fechaTexto"></span>
                    </div>
                    <input type="hidden" id="anioEvaluacion" required>
                    <small>La fecha de evaluaci√≥n corresponde al d√≠a de hoy</small>
                </section>

                <section class="form-section">
                    <h2>3. Tipo de Proveedor</h2>
                    <div class="radio-group" id="tipoProveedorGroup">
                        <label id="labelProducto">
                            <input type="radio" name="tipoProveedor" value="PRODUCTO" required disabled>
                            <span>PRODUCTO</span>
                            <small class="badge-progreso" id="badgeProducto"></small>
                        </label>
                        <label id="labelServicio">
                            <input type="radio" name="tipoProveedor" value="SERVICIO" required disabled>
                            <span>SERVICIO</span>
                            <small class="badge-progreso" id="badgeServicio"></small>
                        </label>
                    </div>
                </section>
                <div class="step-navigation">
                    <button type="button" class="btn-prev" onclick="anteriorPaso()">‚Üê Anterior</button>
                    <button type="button" class="btn-next" onclick="siguientePaso()">Siguiente ‚Üí</button>
                </div>
            </div>

            <!-- Paso 2: Proveedor y Correo -->
            <div class="form-step" id="step2" data-step="2">
                <section class="form-section">
                    <h2>4. Seleccione el Proveedor</h2>
                    <select id="proveedor" required>
                        <option value="">-- Primero seleccione el tipo de proveedor --</option>
                    </select>
                </section>
                <div class="step-navigation">
                    <button type="button" class="btn-prev" onclick="anteriorPaso()">‚Üê Anterior</button>
                    <button type="button" class="btn-next" onclick="siguientePaso()">Siguiente ‚Üí</button>
                </div>
            </div>

            <!-- Paso 3: √çtems de Evaluaci√≥n -->
            <div class="form-step" id="step3" data-step="3">
                <section class="form-section" id="itemsSection" style="display: none;">
                    <h2 id="itemsTitle">6. √çtems de Evaluaci√≥n</h2>
                    <div id="itemsContainer"></div>
                </section>
                <div class="step-navigation">
                    <button type="button" class="btn-prev" onclick="anteriorPaso()">‚Üê Anterior</button>
                    <button type="button" class="btn-next" onclick="siguientePaso()">Siguiente ‚Üí</button>
                </div>
            </div>

            <!-- Paso 4: Resultado y Guardar -->
            <div class="form-step" id="step4" data-step="4">
                <section class="form-section" id="resultSection">
                    <h2>Resultado Final</h2>
                    <div class="result-box">
                        <div class="result-label">Resultado Ponderado:</div>
                        <div class="result-value" id="resultadoFinal">0%</div>
                    </div>
                </section>
                <div class="step-navigation">
                    <button type="button" class="btn-prev" onclick="anteriorPaso()">‚Üê Anterior</button>
                    <button type="submit" id="guardarBtn" class="btn-save" style="margin-left: auto;">üíæ Guardar
                        Evaluaci√≥n</button>
                </div>
            </div>
        </form>
    </div>

    <!-- Modal de √©xito personalizado -->
    <div id="successModal" class="success-modal">
        <div class="success-modal-content">
            <div class="success-icon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" />
                    <path d="M8 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </div>
            <h2>¬°√âxito!</h2>
            <p>Su evaluaci√≥n ha sido enviada</p>
            <button class="success-btn" onclick="cerrarModalExito()">Aceptar</button>
        </div>
    </div>

    <script src="js/script.js?v=56"></script>
    <!-- Scripts en orden: Supabase -> Config -> Service -> Main -->
</body>

</html>